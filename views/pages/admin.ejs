<!DOCTYPE html>
<html lang="en">
<head>
    <%- include ("../partials/head") %>
    <link rel="stylesheet" href="/stylesheets/admin.css">
</head>
<body>
    <div class="content">
        <%- include ("../partials/nav") %>
        <h1>Administration</h1>

        <h3>Tables</h3>
        <table>
            <h3>Users</h3>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Class</th>
                <th>Register Date</th>
                <th>Last Login</th>
                <th></th>
            </tr>
            <% for (let user of users) { %>
                <tr>
                    <td><%= user.ID %></td>
                    <td><%= user.USERNAME %></td>
                    <td><%= user.EMAIL %></td>
                    <td><%= user.CLASS %></td>
                    <td><%= new Date(user.REGISTERDATE).toLocaleString() %></td>
                    <td><%= new Date(user.LOGINDATE).toLocaleString() %></td>
                    <td>
                        <form method="POST" action="/admin/deluser">
                            <input type="hidden" name="id" value="<%= user.ID %>">
                            <input class="x" type="submit" value="x">
                        </form>
                    </td>
                </tr>
            <% } %>
        </table>

        <table>
            <h3>Classes</h3>
            <tr>
                <th>Token</th>
                <th>Class Name</th>
                <th></th>
            </tr>
            <% for (let c of classes) { %>
                <tr>
                    <td><%= c.TOKEN %></td>
                    <td><%= c.NAME %></td>
                    <td>
                        <form method="POST" action="/admin/deltoken">
                            <input type="hidden" name="token" value="<%= c.TOKEN %>">
                            <input class="x" type="submit" value="x">
                        </form>
                    </td>
                </tr>
            <% } %>
        </table>

        <table>
            <h3>Assignments</h3>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Description</th>
                <th>Hints</th>
                <th>Author ID</th>
                <th>Start Code</th>
                <th>Test Code</th>
                <th>Creation Date</th>
                <th>Due Date</th>
                <th></th>
            </tr>
            <% for (let a of assignments) { %>
                <tr>
                    <td><%= a.ID %></td>
                    <td><%= a.NAME %></td>
                    <td><%= a.DESC %></td>
                    <td><%= a.HINTS %></td>
                    <td><%= a.ASSIGNER %></td>
                    <td><%= a.INITIALCODE %></td>
                    <td><%= a.TESTCODE %></td>
                    <td><%= new Date(a.CREATIONDATE).toLocaleString() %></td>
                    <td><%= new Date(a.DUEDATE).toLocaleString() %></td>
                    <td>
                        <form method="POST" action="/admin/delassignment">
                            <input type="hidden" name="id" value="<%= a.ID %>">
                            <input class="x" type="submit" value="x">
                        </form>
                    </td>
                </tr>
            <% } %>
        </table>

        <table>
            <h3>Tests</h3>
            <tr>
                <th>ID</th>
                <th>Assignment</th>
                <th>Inputs</th>
                <th>Outputs</th>
                <th>Visible</th>
                <th></th>
            </tr>
            <% for (let test of tests) { %>
                <tr>
                    <td><%= test.ID %></td>
                    <td><%= test.NAME %></td>
                    <td><%= test.INPUTS %></td>
                    <td><%= test.OUTPUTS %></td>
                    <td><%= test.VISIBLE ? "Yes" : "No" %></td>
                    <td>
                        <form method="POST" action="/admin/deltest">
                            <input type="hidden" name="id" value="<%= test.ID %>">
                            <input class="x" type="submit" value="x">
                        </form>
                    </td>
                </tr>
            <% } %>
        </table>

        <table>
            <h3>Submissions</h3>
            <tr>
                <th>ID</th>
                <th>Assignment</th>
                <th>User</th>
                <th>Code</th>
                <th>Submitted</th>
                <th>Submission Date</th>
            </tr>
            <% for (let s of submissions) { %>
                <tr>
                    <td><%= s.ID %></td>
                    <td><%= s.NAME %></td>
                    <td><%= s.USERNAME %></td>
                    <td><%= s.CODE || "-" %></td>
                    <td><%= s.SUBMITTED ? "Yes" : "No" %></td>
                    <td><%= s.SUBMITDATE || "-" %></td>
                </tr>
            <% } %>
        </table>

        <h3>Options</h3>
        <div>
            <form method="POST" action="/admin/createtoken">
                <fieldset>
                    <legend>Generate an Access Token</legend>
                    <input type="text" name="className" placeholder="Class Name" required><br>
                    <input type="submit" value="Generate an Access Token">
                </fieldset>
            </form>
            <form method="POST" action="/admin/createassignment">
                <fieldset>
                    <legend>Create Assignment</legend>
                    <input type="text" name="title" placeholder="Assignment Title" required><br>
                    <textarea name="desc" placeholder="Assignment Description" required></textarea><br>
                    <textarea name="hints" placeholder="Assignment Hints" required></textarea><br>
                    <textarea name="startCode" placeholder="Starting Code" required></textarea><br>
                    <textarea name="testCode" placeholder="Test Code (code to test against)" required></textarea><br>
                    <label for="date">Due Date</label>
                    <input type="date" name="date" required><br>
                    <input type="submit" value="Create Assignment">
                </fieldset>
            </form>
            <form method="POST" action="/admin/createtest">
                <fieldset>
                    <legend>Create Testcase</legend>
                    <select name="assignment" required>
                        <% for (let a of assignments) { %>
                            <option value="<%= a.ID %>"><%= a.NAME %></option>
                        <% } %>
                    </select><br>
                    <textarea name="inputs" placeholder="Inputs" required></textarea><br>
                    <textarea name="outputs" placeholder="Outputs" required></textarea><br>
                    <label for="visible">Visible Testcase</label>
                    <input type="checkbox" name="visible"><br>
                    <input type="submit" value="Create Testcase">
                </fieldset>
            </form>
            <form method="POST" action="/admin/assignuser">
                <fieldset>
                    <legend>Assign an Assignment to a User</legend>
                    <select name="user" required>
                        <% for (let user of users) { %>
                            <option value="<%= user.ID %>"><%= user.USERNAME %></option>
                        <% } %>
                    </select><br>
                    <select name="assignment" required>
                        <% for (let assignment of assignments) { %>
                            <option value="<%= assignment.ID %>"><%= assignment.NAME %></option>
                        <% } %>
                    </select><br>
                    <input type="submit" value="Assign to User">
                </fieldset>
            </form>
        </div>
    </div>
    <%- include ("../partials/footer") %>
</body>
</html>
 